#!/bin/sh

echo "ğŸ” Running pre-push checks..."

# ai-company-analyzer í”„ë¡œì íŠ¸ ê²½ë¡œ
PROJECT_DIR="extensions/ai-company-analyzer"

# 1. íƒ€ì… ì²´í¬ (ë³‘ë ¬)
echo "ğŸ“ Type checking..."
(cd "$PROJECT_DIR/extension" && bun run typecheck) &
(cd "$PROJECT_DIR/spa" && bun run typecheck) &
wait

if [ $? -ne 0 ]; then
  echo "âŒ Type check failed!"
  exit 1
fi

# 2. ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ë³‘ë ¬)
echo "ğŸ§ª Running unit tests..."
(cd "$PROJECT_DIR/extension" && bun run test:run) &
(cd "$PROJECT_DIR/spa" && bun run test:run) &
wait

if [ $? -ne 0 ]; then
  echo "âŒ Unit tests failed!"
  exit 1
fi

# 3. E2E í…ŒìŠ¤íŠ¸ (Chromiumë§Œ)
echo "ğŸ­ Running E2E tests (Chromium only)..."
(cd "$PROJECT_DIR/spa" && bun run e2e:chromium)

if [ $? -ne 0 ]; then
  echo "âŒ E2E tests failed!"
  exit 1
fi

# 4. ë¹Œë“œ ê²€ì¦
echo "ğŸ—ï¸ Building..."
(cd "$PROJECT_DIR/extension" && bun run build) &
(cd "$PROJECT_DIR/spa" && bun run build) &
wait

if [ $? -ne 0 ]; then
  echo "âŒ Build failed!"
  exit 1
fi

echo "âœ… All checks passed!"
