# 12. íšŒì‚¬ ìƒì„¸ í˜ì´ì§€

## ê°œìš”
íšŒì‚¬ë³„ ìƒì„¸ ì •ë³´ ë° AI ë¶„ì„ ê²°ê³¼ í˜ì´ì§€ êµ¬í˜„

## ì„ í–‰ ì¡°ê±´
- 09-webllm-text-analysis ì™„ë£Œ
- 10-transformers-image-analysis ì™„ë£Œ
- 11-list-page ì™„ë£Œ

## ê¸°ìˆ  ìŠ¤íƒ
| ë¶„ë¥˜ | ê¸°ìˆ  |
|------|------|
| UI | React + TypeScript |
| ë°ì´í„° ì¡°íšŒ | dexie-react-hooks |

---

## í™”ë©´ êµ¬ì„±

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â† ëª©ë¡ìœ¼ë¡œ                                     [ì¬ë¶„ì„]     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ì‚¼ì„±ì „ì                                                    â”‚
â”‚ ë§ˆì§€ë§‰ ìˆ˜ì§‘: 2024-01-15                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ AI ë¶„ì„ ê²°ê³¼                                                â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ì¢…í•© ì ìˆ˜: â­ 4.2 / 5.0                                 â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚ ğŸ“Š Runway: 24ê°œì›” (ì‹ ë¢°ë„: ë†’ìŒ)                        â”‚ â”‚
â”‚ â”‚ ë¶„ì„: í˜„ê¸ˆ íë¦„ì´ ì•ˆì •ì ì´ë©°...                         â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚ âš ï¸ ì¬ë¬´ ë¦¬ìŠ¤í¬: ë‚®ìŒ                                    â”‚ â”‚
â”‚ â”‚ â€¢ ë¶€ì±„ë¹„ìœ¨ ì–‘í˜¸                                         â”‚ â”‚
â”‚ â”‚ â€¢ í˜„ê¸ˆ ë³´ìœ ëŸ‰ ì¶©ë¶„                                      â”‚ â”‚
â”‚ â”‚                                                         â”‚ â”‚
â”‚ â”‚ ğŸ’¬ ë¦¬ë·° ìš”ì•½                                            â”‚ â”‚
â”‚ â”‚ ê¸ì •: ë³µì§€ ì¢‹ìŒ, ì—°ë´‰ ë†’ìŒ, ì„±ì¥ ê°€ëŠ¥ì„±                 â”‚ â”‚
â”‚ â”‚ ë¶€ì •: ì•¼ê·¼ ë§ìŒ, ê²½ìŸ ì‹¬í•¨                              â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ìˆ˜ì§‘ëœ ë°ì´í„°                                               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚ â”‚ ì›í‹°ë“œ   â”‚ â”‚ í˜ì‹ ì˜ìˆ²  â”‚ â”‚ DART     â”‚                     â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚ [ì„ íƒëœ ì†ŒìŠ¤ì˜ ë°ì´í„° í‘œì‹œ]                                 â”‚
â”‚ - í…ìŠ¤íŠ¸ ë°ì´í„°                                             â”‚
â”‚ - ê·¸ë˜í”„ ì´ë¯¸ì§€ (í´ë¦­ ì‹œ ëª¨ë‹¬)                              â”‚
â”‚ - PDF í˜ì´ì§€ë“¤                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## êµ¬í˜„

### src/pages/detail/DetailPage.tsx

```typescript
import React, { useState, useEffect } from 'react';
import { createRoot } from 'react-dom/client';
import { useLiveQuery } from 'dexie-react-hooks';
import { db } from '@/lib/db';
import { getImageUrl, getAnalysisResult, saveAnalysisResult } from '@/lib/storage';
import type { Company, ExtractedData, AnalysisResult } from '@/types/storage';
import './detail.css';

function DetailPage() {
  const [companyId, setCompanyId] = useState<string | null>(null);
  const [selectedSource, setSelectedSource] = useState<string | null>(null);
  const [isAnalyzing, setIsAnalyzing] = useState(false);
  const [modalImage, setModalImage] = useState<string | null>(null);

  // URLì—ì„œ íšŒì‚¬ ID ì¶”ì¶œ
  useEffect(() => {
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');
    setCompanyId(id);
  }, []);

  // íšŒì‚¬ ì •ë³´ ì¡°íšŒ
  const company = useLiveQuery(
    () => (companyId ? db.companies.get(companyId) : undefined),
    [companyId]
  );

  // ë¶„ì„ ê²°ê³¼ ì¡°íšŒ
  const analysisResult = useLiveQuery(
    () => (companyId ? db.analysisResults.where('companyId').equals(companyId).last() : undefined),
    [companyId]
  );

  // ì¶”ì¶œ ë°ì´í„° ì¡°íšŒ
  const extractedData = useLiveQuery(
    () => (companyId ? db.extractedData.where('companyId').equals(companyId).toArray() : []),
    [companyId],
    []
  );

  // ì†ŒìŠ¤ë³„ ê·¸ë£¹í•‘
  const sourceGroups = React.useMemo(() => {
    const groups: Record<string, ExtractedData[]> = {};
    extractedData.forEach((data) => {
      const source = getSourceLabel(data.type);
      if (!groups[source]) groups[source] = [];
      groups[source].push(data);
    });
    return groups;
  }, [extractedData]);

  // ì¬ë¶„ì„ ì‹¤í–‰
  const handleReanalyze = async () => {
    if (!companyId) return;

    setIsAnalyzing(true);

    try {
      // í…ìŠ¤íŠ¸ ë°ì´í„° ìˆ˜ì§‘
      const textData = extractedData
        .filter((d) => d.textContent)
        .map((d) => d.textContent!)
        .join('\n\n');

      // ì¬ë¬´ ë¶„ì„
      const financialResult = await chrome.runtime.sendMessage({
        type: 'ANALYZE_FINANCIALS',
        payload: { data: textData },
      });

      // ë¦¬ë·° ë¶„ì„
      const reviews = extractedData
        .filter((d) => d.type.includes('review'))
        .map((d) => d.textContent!)
        .filter(Boolean);

      const reviewResult = await chrome.runtime.sendMessage({
        type: 'ANALYZE_REVIEWS',
        payload: { reviews },
      });

      // ì¢…í•© ì ìˆ˜ ê³„ì‚°
      const scoreResult = await chrome.runtime.sendMessage({
        type: 'CALCULATE_SCORE',
        payload: {
          financial: financialResult.result,
          review: reviewResult.result,
        },
      });

      // ê²°ê³¼ ì €ì¥
      await saveAnalysisResult({
        companyId,
        analyzedAt: Date.now(),
        totalScore: scoreResult.result?.score || 0,
        runway: financialResult.result?.runway,
        financialRisk: financialResult.result?.risk,
        reviewSummary: reviewResult.result,
      });
    } catch (error) {
      console.error('ë¶„ì„ ì‹¤íŒ¨:', error);
      alert('ë¶„ì„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
    } finally {
      setIsAnalyzing(false);
    }
  };

  // ë’¤ë¡œê°€ê¸°
  const handleBack = () => {
    chrome.tabs.create({
      url: chrome.runtime.getURL('pages/list/list.html'),
    });
  };

  if (!companyId || !company) {
    return <div className="loading">ë¡œë”© ì¤‘...</div>;
  }

  return (
    <div className="detail-page">
      <header className="page-header">
        <button className="back-btn" onClick={handleBack}>
          â† ëª©ë¡ìœ¼ë¡œ
        </button>
        <button
          className="reanalyze-btn"
          onClick={handleReanalyze}
          disabled={isAnalyzing}
        >
          {isAnalyzing ? 'ë¶„ì„ ì¤‘...' : 'ì¬ë¶„ì„'}
        </button>
      </header>

      <section className="company-info">
        <h1>{company.name}</h1>
        <p className="last-updated">
          ë§ˆì§€ë§‰ ìˆ˜ì§‘: {new Date(company.updatedAt).toLocaleDateString()}
        </p>
      </section>

      {/* AI ë¶„ì„ ê²°ê³¼ */}
      <section className="analysis-section">
        <h2>AI ë¶„ì„ ê²°ê³¼</h2>
        {analysisResult ? (
          <AnalysisCard result={analysisResult} />
        ) : (
          <div className="no-analysis">
            <p>ì•„ì§ ë¶„ì„ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</p>
            <button onClick={handleReanalyze} disabled={isAnalyzing}>
              ë¶„ì„ ì‹œì‘
            </button>
          </div>
        )}
      </section>

      {/* ìˆ˜ì§‘ëœ ë°ì´í„° */}
      <section className="data-section">
        <h2>ìˆ˜ì§‘ëœ ë°ì´í„°</h2>
        <div className="source-tabs">
          {Object.keys(sourceGroups).map((source) => (
            <button
              key={source}
              className={`tab ${selectedSource === source ? 'active' : ''}`}
              onClick={() => setSelectedSource(source)}
            >
              {source}
            </button>
          ))}
        </div>

        {selectedSource && sourceGroups[selectedSource] && (
          <DataList
            data={sourceGroups[selectedSource]}
            onImageClick={setModalImage}
          />
        )}
      </section>

      {/* ì´ë¯¸ì§€ ëª¨ë‹¬ */}
      {modalImage && (
        <ImageModal
          imageUrl={modalImage}
          onClose={() => setModalImage(null)}
        />
      )}
    </div>
  );
}

// ë¶„ì„ ê²°ê³¼ ì¹´ë“œ
function AnalysisCard({ result }: { result: AnalysisResult }) {
  return (
    <div className="analysis-card">
      <div className="total-score">
        ì¢…í•© ì ìˆ˜: â­ {result.totalScore.toFixed(1)} / 5.0
      </div>

      {result.runway && (
        <div className="analysis-item">
          <h4>ğŸ“Š Runway</h4>
          <p>
            {result.runway.months}ê°œì›” (ì‹ ë¢°ë„: {result.runway.confidence})
          </p>
          <p className="reasoning">{result.runway.reasoning}</p>
        </div>
      )}

      {result.financialRisk && (
        <div className="analysis-item">
          <h4>âš ï¸ ì¬ë¬´ ë¦¬ìŠ¤í¬: {result.financialRisk.level}</h4>
          <ul>
            {result.financialRisk.factors.map((factor, i) => (
              <li key={i}>{factor}</li>
            ))}
          </ul>
        </div>
      )}

      {result.reviewSummary && (
        <div className="analysis-item">
          <h4>ğŸ’¬ ë¦¬ë·° ìš”ì•½</h4>
          <p>
            <strong>ê¸ì •:</strong> {result.reviewSummary.positive.join(', ')}
          </p>
          <p>
            <strong>ë¶€ì •:</strong> {result.reviewSummary.negative.join(', ')}
          </p>
          <p className="summary">{result.reviewSummary.summary}</p>
        </div>
      )}
    </div>
  );
}

// ë°ì´í„° ë¦¬ìŠ¤íŠ¸
function DataList({
  data,
  onImageClick,
}: {
  data: ExtractedData[];
  onImageClick: (url: string) => void;
}) {
  const [imageUrls, setImageUrls] = useState<Record<string, string>>({});

  useEffect(() => {
    // ì´ë¯¸ì§€ URL ë¡œë“œ
    data.forEach(async (item) => {
      if (!item.textContent) {
        const url = await getImageUrl(item.id);
        if (url) {
          setImageUrls((prev) => ({ ...prev, [item.id]: url }));
        }
      }
    });
  }, [data]);

  return (
    <div className="data-list">
      {data.map((item) => (
        <div key={item.id} className="data-item">
          <div className="data-meta">
            <span className="data-type">{item.type}</span>
            <span className="data-date">
              {new Date(item.extractedAt).toLocaleDateString()}
            </span>
          </div>

          {item.textContent ? (
            <div className="text-content">{item.textContent}</div>
          ) : imageUrls[item.id] ? (
            <img
              src={imageUrls[item.id]}
              alt="ìˆ˜ì§‘ëœ ì´ë¯¸ì§€"
              className="image-thumbnail"
              onClick={() => onImageClick(imageUrls[item.id])}
            />
          ) : (
            <div className="loading-image">ì´ë¯¸ì§€ ë¡œë”© ì¤‘...</div>
          )}
        </div>
      ))}
    </div>
  );
}

// ì´ë¯¸ì§€ ëª¨ë‹¬
function ImageModal({
  imageUrl,
  onClose,
}: {
  imageUrl: string;
  onClose: () => void;
}) {
  return (
    <div className="modal-overlay" onClick={onClose}>
      <div className="modal-content" onClick={(e) => e.stopPropagation()}>
        <button className="modal-close" onClick={onClose}>
          âœ•
        </button>
        <img src={imageUrl} alt="í™•ëŒ€ ì´ë¯¸ì§€" />
      </div>
    </div>
  );
}

// ë°ì´í„° íƒ€ì… â†’ ì†ŒìŠ¤ ë ˆì´ë¸”
function getSourceLabel(type: string): string {
  const labels: Record<string, string> = {
    company_info: 'ì›í‹°ë“œ',
    finance_inno: 'í˜ì‹ ì˜ìˆ²',
    finance_dart: 'DART',
    finance_smes: 'ì¤‘ê¸°ë²¤ì²˜',
    review_blind: 'ë¸”ë¼ì¸ë“œ',
    review_jobplanet: 'ì¡í”Œë˜ë‹›',
  };
  return labels[type] || type;
}

// ë Œë”ë§
const root = createRoot(document.getElementById('root')!);
root.render(<DetailPage />);
```

---

## ì‚°ì¶œë¬¼

| íŒŒì¼ | ì„¤ëª… |
|------|------|
| `src/pages/detail/DetailPage.tsx` | ìƒì„¸ í˜ì´ì§€ ì»´í¬ë„ŒíŠ¸ |
| `src/pages/detail/detail.css` | ìŠ¤íƒ€ì¼ |
| `src/pages/detail/detail.html` | HTML ì—”íŠ¸ë¦¬ |

---

## ì°¸ì¡° ë¬¸ì„œ
- [spec/05-ui-structure.md](../spec/05-ui-structure.md) - UI êµ¬ì¡° (ìƒì„¸ í˜ì´ì§€ ì„¹ì…˜)
